<div class="flex flex-col items-center w-full">
  <div class="absolute top-5 left-5 font-bold text-2xl">Book<span class="text-blue-500">Bridge</span></div>
  <div class="w-[65%] mt-20">
    <div class="flex items-center justify-between">
      <h1 class="text-2xl font-semibold">My Transactions</h1>
      <form method="get" class="flex items-center">
        <select name="role" class="w-30 select border border-gray-300 rounded-lg bg-white px-3 py-2 text-sm">
          <option value="using" <%= params[:role] == 'using' ? 'selected' : '' %>>I'm Using</option>
          <option value="sharing" <%= params[:role] == 'sharing' ? 'selected' : '' %>>I'm Sharing</option>
          <option value="all" <%= params[:role] == 'all' ? 'selected' : '' %>>All</option>
        </select>
        <button class="ml-2 px-3 py-2 bg-blue-500 text-white rounded-lg text-sm">Filter</button>
      </form>
    </div>
    <div class="mt-8 divide-y divide-gray-200">
      <% filtered = case params[:role]
          when 'using' then @transactions.select { |t| t.borrower_id == current_user.id }
          when 'sharing' then @transactions.select { |t| t.lender_id == current_user.id }
          else @transactions
        end %>
      <% filtered.each do |t| %>
        <div class="py-8 first:pt-0">
            <%= render ListingCardComponent.new(listing: t.listing, mode: :transaction, transaction: t) %>
            <div class="mt-2 text-xs text-gray-500 flex gap-4">
              <% if t.start_date || t.end_date %>
                <div>
                  <span class="font-medium">Dates:</span>
                  <%= [t.start_date, t.end_date].compact.join(' - ') %>
                </div>
              <% end %>
              <div><span class="font-medium">Lender:</span> <%= t.lender.name %></div>
              <div><span class="font-medium">Borrower:</span> <%= t.borrower.name %></div>
            </div>
          </div>
        <% end %>
        <% if filtered.empty? %>
          <div class="py-16 text-center text-gray-500">No transactions found.</div>
        <% end %>
      </div>
    </div>
  </div>
