<div class="flex flex-col items-center">
  <div class="absolute top-5 left-5 font-bold text-2xl">Book<span class="text-blue-500">Bridge</span></div>
  <div class="mt-15">
    <%= search_form_for @q, url: listings_path, method: :get, html: { class: "flex flex-col items-center" } do |f| %>
      <div class="absolute top-5 left-5 font-bold text-2xl">
        Book<span class="text-blue-500">Bridge</span>
      </div>
      <div class=" grid grid-cols-[8fr_4fr_4fr_4fr_1fr] gap-2 mt-4 " data-controller="search">
        <%= f.search_field :title_cont, placeholder: "Search by title", class: "input bg-transparent w-full border border-gray-400 rounded-lg", "data-search-target": "optionA", value: params.dig(:q, :title_cont) %>
        <%= f.search_field :authors_cont, placeholder: "Search by authors", class: "input bg-transparent w-full border border-gray-400 rounded-lg", "data-search-target": "optionB", value: params.dig(:q, :authors_cont) %>
        <%= f.search_field :isbn_cont, placeholder: "Search by ISBN", class: "input bg-transparent w-full border border-gray-400 rounded-lg", "data-search-target": "optionC", value: params.dig(:q, :isbn_cont) %>
        <%= f.search_field :course_number_cont, placeholder: "Search by course number", class: "input bg-transparent w-full border border-gray-400 rounded-lg", "data-search-target": "optionD", value: params.dig(:q, :course_number_cont) %>
        <select class="select border border-gray-400 bg-transparent rounded-lg" data-search-target="searchInput" data-action="change->search#updateVisibility" name="q[selected_input]">
          <option value="title" <%= @selected_input == "title" ? "selected" : "" %>>Title</option>
          <option value="authors" <%= @selected_input == "authors" ? "selected" : "" %>>Authors</option>
          <option value="isbn" <%= @selected_input == "isbn" ? "selected" : "" %>>ISBN</option>
          <option value="course_number" <%= @selected_input == "course_number" ? "selected" : "" %>>Course Number</option>
        </select>
        <%= f.select :listing_type_eq, options_for_select([ ["Borrow", "Lend"], ["Purchase", "Sell"], ["Either", ""] ], params.dig(:q, :listing_type_eq)), { include_blank: "Select Listing Type" }, class: "select border border-gray-400 rounded-lg bg-transparent" %>
        <%= f.select :sorts, options_for_select([ ["Title (A-Z)", "title asc"], ["Title (Z-A)", "title desc"], ["Price (Low to High)", "price asc"], ["Price (High to Low)", "price desc"], ["Most Recent", "created_at desc"], ["Oldest", "created_at asc"] ], params.dig(:q, :sorts)), { include_blank: "Sort by" }, class: "select border border-gray-400 rounded-lg bg-transparent" %>
        <button type="submit" class="bg-blue-500 text-white w-10 px-2.5 py-2 rounded-xl hover:bg-blue-600 hover:cursor-pointer transition duration-300 ease-in-out">
            <svg width="22px" height="22px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
              <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
              <g id="SVGRepo_iconCarrier">
                <path d="M15.7955 15.8111L21 21M18 10.5C18 14.6421 14.6421 18 10.5 18C6.35786 18 3 14.6421 3 10.5C3 6.35786 6.35786 3 10.5 3C14.6421 3 18 6.35786 18 10.5Z" stroke="#ffffffff" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"></path>
              </g>
            </svg>
          </button>
        </div>
      <% end %>
    </div>
    <% if params[:q].blank? && @listings.empty? %>
      <div class="mt-10 w-[65%] min-h-[70vh] flex items-center justify-center">
        <p class="text-gray-800 text-3xl">Looks like you haven't searched for anything</p>
      </div>
    <% elsif @listings.empty? %>
      <div class="mt-10 w-[65%] min-h-[70vh] flex flex-col items-center justify-center gap-4">
        <p class="text-gray-800 text-3xl">Woah! Looks like thereâ€™s no book to be found.</p>
        <% if current_user && params[:q].present? %>
          <% if @existing_subscription %>
            <div class="flex items-center gap-3">
              <div class="flex items-center bg-green-100 text-green-700 px-5 py-2 rounded-md text-sm font-medium gap-2">
                <!-- All set icon -->
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="size-6"><path d="M5.85 3.5a.75.75 0 0 0-1.117-1 9.719 9.719 0 0 0-2.348 4.876.75.75 0 0 0 1.479.248A8.219 8.219 0 0 1 5.85 3.5ZM19.267 2.5a.75.75 0 1 0-1.118 1 8.22 8.22 0 0 1 1.987 4.124.75.75 0 0 0 1.48-.248A9.72 9.72 0 0 0 19.266 2.5Z" /><path fill-rule="evenodd" d="M12 2.25A6.75 6.75 0 0 0 5.25 9v.75a8.217 8.217 0 0 1-2.119 5.52.75.75 0 0 0 .298 1.206c1.544.57 3.16.99 4.831 1.243a3.75 3.75 0 1 0 7.48 0 24.583 24.583 0 0 0 4.83-1.244.75.75 0 0 0 .298-1.205 8.217 8.217 0 0 1-2.118-5.52V9A6.75 6.75 0 0 0 12 2.25ZM9.75 18c0-.034 0-.067.002-.1a25.05 25.05 0 0 0 4.496 0l.002.1a2.25 2.25 0 1 1-4.5 0Z" clip-rule="evenodd" /></svg>
                All set!
              </div>
              <%= button_to subscription_path(@existing_subscription), method: :delete, form: { class: 'inline' }, class: 'bg-red-100 text-red-600 hover:bg-red-200 rounded-md px-3 py-2 flex items-center justify-center transition' do %>
                <!-- Delete icon -->
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="size-6"><path d="M3.53 2.47a.75.75 0 0 0-1.06 1.06l18 18a.75.75 0 1 0 1.06-1.06l-18-18ZM20.57 16.476c-.223.082-.448.161-.674.238L7.319 4.137A6.75 6.75 0 0 1 18.75 9v.75c0 2.123.8 4.057 2.118 5.52a.75.75 0 0 1-.297 1.206Z" /><path fill-rule="evenodd" d="M5.25 9c0-.184.007-.366.022-.546l10.384 10.384a3.751 3.751 0 0 1-7.396-1.119 24.585 24.585 0 0 1-4.831-1.244.75.75 0 0 1-.298-1.205A8.217 8.217 0 0 0 5.25 9.75V9Zm4.502 8.9a2.25 2.25 0 1 0 4.496 0 25.057 25.057 0 0 1-4.496 0Z" clip-rule="evenodd" /></svg>
              <% end %>
            </div>
          <% else %>
            <%= form_with url: subscriptions_path, method: :post, class: 'flex items-center gap-3' do %>
              <%# Pass through the ransack query params to create subscription %>
              <% params[:q].each do |k,v| %>
                <%= hidden_field_tag "q[#{k}]", v %>
              <% end %>
              <button type="submit" class="flex items-center gap-2 bg-blue-100 text-blue-700 hover:bg-blue-200 px-5 py-2 rounded-md text-sm font-medium transition">
                <!-- Set arrival notification icon -->
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6"><path stroke-linecap="round" stroke-linejoin="round" d="M14.857 17.082a23.848 23.848 0 0 0 5.454-1.31A8.967 8.967 0 0 1 18 9.75V9A6 6 0 0 0 6 9v.75a8.967 8.967 0 0 1-2.312 6.022c1.733.64 3.56 1.085 5.455 1.31m5.714 0a24.255 24.255 0 0 1-5.714 0m5.714 0a3 3 0 1 1-5.714 0M3.124 7.5A8.969 8.969 0 0 1 5.292 3m13.416 0a8.969 8.969 0 0 1 2.168 4.5" /></svg>
                Set arrival notification
              </button>
            <% end %>
          <% end %>
        <% end %>
      </div>
    <% else %>
      <div class="mt-4 w-[65%] min-h-[70vh] flex flex-col">
        <div class="flex items-center justify-between">
          <p> <%= @listings.count %> results found for your search. </p>
        </div>
        <% @listings.each do |listing| %>
          <% saved_item = current_user.saved_items.find_by(listing_id: listing.id) %>
          <%= render ListingCardComponent.new(listing: listing, mode: :saved, saved_item: saved_item) %>
        <% end %>
      </div>
    <% end %>
  </div>
