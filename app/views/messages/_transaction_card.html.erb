<!-- app/views/messages/_transaction_card.html.erb -->
<% txn = message.messageable %>
<% mine = current_user.id == message.sender_id %>
<div class="p-3 rounded-xl text-xs space-y-1 w-2/5 flex-row <%= mine ? 'bg-blue-100 ml-auto justify-end' : 'bg-gray-100 justify-start' %>">
  <div class="font-semibold text-gray-700 text-sm"><%= message.listing.title %></div>
  <div class="text-gray-500">Status: <span class="font-medium"><%= txn.status.humanize %></span></div>
  <% if message.listing.listing_type == "lend" %>
    <div class="text-gray-500">Start: <%= txn.start_date || "â€”" %></div>
    <div class="text-gray-500">End: <%= txn.end_date %></div>
  <% end %>
  <% if current_user.id == message.receiver_id && txn.pending? %>
    <%= button_to "Got the book",
      transaction_path(txn, mark: "got_the_book"),
      method: :patch,
      class: "mt-2 px-3 py-1 bg-blue-600 hover:bg-blue-700 text-white rounded-md text-[11px]" %>
  <% end %>
  <% if mine && txn.pending? %>
    <%= button_to "Cancel",
      transaction_path(txn, transaction: { status: :cancelled }),
      method: :patch,
      class: "mt-2 px-3 py-1 bg-red-600 hover:bg-red-700 text-white rounded-md text-[11px]" %>
  <% end %>
</div>
