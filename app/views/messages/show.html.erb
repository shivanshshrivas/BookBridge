<div class="flex flex-col items-center">
  <div class="absolute top-5 left-5 font-bold text-2xl">Book<span class="text-blue-500">Bridge</span></div>
  <div class="flex h-[80vh] w-[65%] mt-15 border border-gray-300 rounded-lg overflow-hidden">
    <%= render partial: "messages/thread_list", locals: { threads: @threads } %>
    <div class="flex-1 flex flex-col">
      <!-- Header -->
      <div class="px-4 py-3 border-b border-gray-300 flex items-center justify-between bg-white">
        <div>
          <div class="font-semibold"><%= @listing.title %></div>
          <div class="text-xs text-gray-500">Conversation with <%= @other.name %></div>
        </div>
        <%= link_to 'Back', messages_path, class: 'text-xs text-blue-600 hover:underline md:hidden' %>
      </div>
      <!-- Messages Scroll Area -->
      <div id="thread" class="flex-1 overflow-y-auto px-4 py-4 space-y-3 bg-gray-50">
        <% @messages.each do |m| %>
          <% if m.messageable.is_a?(TextMessage) %>
            <% mine = m.sender_id == current_user.id %>
            <div class="flex <%= mine ? 'justify-end' : 'justify-start' %>">
              <div class="max-w-[70%] rounded-xl px-4 py-2 text-sm <%= mine ? 'bg-blue-500 text-white' : 'bg-gray-200 text-gray-800' %>">
                <p class="whitespace-pre-line leading-relaxed"><%= m.messageable.content %></p>
                <div class="mt-1 text-[10px] opacity-70 text-right"><%= time_ago_in_words(m.created_at) %> ago</div>
              </div>
            </div>
          <% else %>
            <%= render "messages/transaction_card", message: m %>
          <% end %>
        <% end %>
      </div>
      <!-- Composer -->
      <div class="border-t bg-white p-3">
        <%= render "messages/form", listing: @listing, other: @other %>
      </div>
    </div>
  </div>
</div>
